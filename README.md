# StmSample
Проект примеров работы с периферией STM32f4 и набор библиотечных файлов для работы с этой периферией

## Модуль usart

### Драйвер
`usart_driver.c` - обеспечивает типовую настройку порта USART с выбором порта и скорости обмена

Использование:
`initUSART(USART_TypeDef* UART, uint32_t speed, DMA_Trancieve_State dma_state, IRQ_Recieve_State irq_state)` - UART выбор порта, speed выбор скорости, dma_state - флаг настройки DMA на передачу данных (без вызова прерываний после окончания передачи), irq_state - флаг настройки прерываний на прием (обработка прерывания должна производиться в вызывающем коде!)
`sendUARTByDMA(USART_TypeDef* UART, uint8_t *array, uint8_t size)` - отправка массива array длины size через порт UART (перед отправкой происходит ожидание окончания предыдущей передачи)
`testUART` - запуск тестирования настройки порта на передачу, отправляются байт 0xAA и массив {1,2,3,4,5,6,7,8,9,10} через DMA.

### Логгер
'usart_logger.c' - логгер для STM32 работающий через USART. Настройка производится путем установки define-ов:
* LOG_SPEED = 115200 - скорость порта
* LOG_USARTx (x = 1,2,3)
        Note: пока полноценная реализация для USART3
* LOG_DMA - включение использования DMA для передачи данных по usart
* LOG_BUF - установка размера буфера

Использование:
Потокозащищенные
`sendStringByDMAandWait(char *str, uint8_t size)` - отправка строки и о
`sendStringByDMAAfterWait(char *str, uint8_t size)`

### Буфферезированный UART
`
Модуль для привязки буферов к UART на прием и на передачу(на передачу пока не реализован).
Передача осуществляется с использованием DMA, прием и спользованием прерываний.

 ## Пример использования DEFINE-ов с Cmake
 Пример использования DEFINE-ов с Cmake для сборки нескольких исполняемых файлов из одних исходников с различиями связанными  с установленными DEFINE-ами.
 BIN1 -- main.c (-define1) --- lib.c (-define3)
 BIN2 -- main.c (-define2) --- lib.c (-define4)
 Это дает возможность:
 - настраивать библиотеки с использованием DEFINE
 - использовать единые векторы прерываний в различных библиотечных файлах с "активацией" DEFINE-ами при компиляции/сборке
 
 
 
 
 
 
 
